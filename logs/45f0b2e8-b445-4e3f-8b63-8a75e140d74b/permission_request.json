[
  {
    "session_id": "45f0b2e8-b445-4e3f-8b63-8a75e140d74b",
    "transcript_path": "/home/ben/.claude/projects/-home-ben-work-personal-claude-code-observability/45f0b2e8-b445-4e3f-8b63-8a75e140d74b.jsonl",
    "cwd": "/home/ben/work_personal/claude_code_observability",
    "permission_mode": "default",
    "hook_event_name": "PermissionRequest",
    "tool_name": "Write",
    "tool_input": {
      "file_path": "/home/ben/work_personal/claude_code_observability/CLAUDE.md",
      "content": "# Claude Code Radar (CCR)\n\n*\"I see a bad moon rising, I see trouble on the way\"* \ud83c\udfb5\n\n## Project Overview\n\nClaude Code Radar is a real-time monitoring and logging system for Claude Code sessions. It captures every event during a Claude Code session\u2014tool calls, prompts, errors, subagent activity, context compaction\u2014and provides a web dashboard for visualization and analysis.\n\n## Architecture\n\nThe system has three main components:\n\n### 1. Hooks (`.claude/hooks/`)\nPython scripts that execute in response to Claude Code events. Each hook:\n- Logs events to JSON files in `logs/`\n- Sends events to the backend HTTP server at `http://localhost:8000/events`\n- Uses `uv` inline script declarations for dependency management\n- **Critical**: Hook scripts must be fast (<100ms) to avoid slowing down Claude Code\n\n**Key hooks:**\n- `session_start.py` - Session initialization tracking\n- `user_prompt_submit.py` - User prompt logging, session data management\n- `pre_tool_use.py` - Tool call validation and dangerous command blocking\n- `post_tool_use.py` - Tool completion logging\n- `send_event.py` - Central event dispatcher to backend server\n- `status_line_v6.py` - Context window usage display\n\n**Utilities in `hooks/utils/`:**\n- `summarizer.py` - AI-generated event summaries\n- `model_extractor.py` - Extract model info from transcripts\n- `hitl.py` - Human-in-the-loop helpers\n- `llm/` - LLM API helpers (Anthropic, OpenAI)\n- `tts/` - Text-to-speech integrations\n\n### 2. Backend (`backend/`)\nFastAPI server that:\n- Receives events via `POST /events`\n- Stores events in SQLite (`events.db`)\n- Provides REST API for frontend queries\n- Serves real-time event stream via Server-Sent Events (SSE)\n\n**Stack:** Python 3.11+, FastAPI, Uvicorn, SQLite\n\n**Key files:**\n- `main.py` - FastAPI app, route definitions\n- `events.py` - Event models and validation\n- `database.py` - SQLite schema and queries\n- `test_events.py` - Integration test script\n\n### 3. Frontend (`frontend/`)\nReact dashboard for visualizing session data:\n- Session list view with status and metrics\n- Session detail view with event timeline\n- Real-time monitoring and charts\n- Tool usage statistics and error tracking\n\n**Stack:** TypeScript, React 19, Vite\n\n## Development Workflow\n\n### Running the Full Stack\n\n1. **Start backend** (terminal 1):\n   ```bash\n   cd backend\n   source venv/bin/activate  # or create venv if needed\n   uvicorn main:app --reload\n   ```\n\n2. **Start frontend** (terminal 2):\n   ```bash\n   cd frontend\n   npm run dev\n   ```\n\n3. **Use Claude Code normally** - events automatically flow to dashboard at `http://localhost:5173`\n\n### Testing\n\nGenerate test events:\n```bash\npython backend/test_events.py\n```\n\nThis creates sample sessions with various tools, errors, and edge cases to populate the dashboard.\n\n## Key Conventions\n\n### Hook Development\n- **Speed matters**: Hooks run synchronously. Keep them fast.\n- **Error handling**: Hooks should never crash Claude Code. Wrap risky operations in try/except.\n- **Logging**: Use JSON for structured logs in `logs/`\n- **Dependencies**: Declare inline with `uv` script directives (`# /// script`)\n\n### Event Schema\nEvents sent to backend include:\n- `event_type` - Event name (e.g., \"PreToolUse\", \"SessionStart\")\n- `timestamp` - ISO 8601 format\n- `session_id` - UUID for grouping events\n- `model` - Claude model being used\n- Event-specific fields (tool names, error messages, etc.)\n\n### Frontend State\n- Use React hooks for state management\n- Fetch from `/api/*` endpoints\n- Subscribe to `/stream` for real-time updates\n- Keep UI responsive during high event volume\n\n## Important Paths\n\n- `.claude/hooks/` - Hook scripts\n- `.claude/settings.json` - Hook configuration\n- `logs/` - Event logs (JSON files)\n- `backend/events.db` - SQLite database\n- `backend/main.py` - Backend entry point\n- `frontend/src/` - React components\n\n## Common Tasks\n\n### Adding a New Event Type\n1. Add hook script to `.claude/hooks/`\n2. Register in `.claude/settings.json`\n3. Update backend event model in `events.py`\n4. Add database schema support in `database.py`\n5. Update frontend UI components\n\n### Debugging Hook Issues\n- Check `backend/server.log` for backend errors\n- Check `logs/` for event JSON structure\n- Use `--reload` with uvicorn for live backend changes\n- Test hooks independently with sample event data\n\n### Database Changes\n- Database is SQLite, schema in `database.py`\n- Delete `events.db` to reset (dev only)\n- Use `test_events.py` to repopulate test data\n\n## Technical Constraints\n\n- **Hook performance**: Must not slow down Claude Code session\n- **Database size**: SQLite can grow large; consider cleanup strategies for production\n- **Real-time requirements**: Frontend expects sub-second event updates\n- **Concurrent sessions**: System should handle multiple Claude Code sessions simultaneously\n- **Error isolation**: Hook failures should not break Claude Code functionality\n\n## Hook Safety\n\nThe `pre_tool_use.py` hook implements safety checks:\n- **Dangerous rm blocks**: `rm -rf` is blocked except in allowed directories\n- Tool call summaries logged for debugging\n- Validation happens before tool execution\n\n## Status Line\n\n`status_line_v6.py` displays context window usage:\n```\n[Model] # [###---] | 42.5% used | ~115k left | session_id\n```\n\nColor-coded: green (<50%), yellow (<75%), red (<90%)\n\n## Environment Variables\n\n- `CLAUDE_HOOKS_LOG_DIR` - Custom log directory (default: `logs/`)\n- Backend uses `.env` for configuration (if needed)\n\n## Notes for AI Assistants\n\nWhen working on this codebase:\n- **Hook changes**: Test with real Claude Code sessions, not just unit tests\n- **Backend changes**: Use `uvicorn --reload` for fast iteration\n- **Frontend changes**: Vite hot reload handles most updates\n- **Event schema changes**: Update all three components (hook, backend, frontend)\n- **Performance**: Profile hooks if Claude Code feels slow\n- **Database queries**: Keep them simple; SQLite is fast enough for this use case\n"
    },
    "permission_suggestions": [
      {
        "type": "setMode",
        "mode": "acceptEdits",
        "destination": "session"
      }
    ]
  }
]